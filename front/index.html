<html>

<head>

  <link rel="stylesheet" href="style.css">

</head>
<body>

  <div id="stash" class="">

    <div id="add" class="hidden">
      <label class="info center">Drag file here</label>
    </div>

    <div id="progress" class="">

    </div>

    <input id="file-input" class="hidden" type="file" accept="*/*" onchange="addFiles(this.files)">
  </div>



<script type="text/javascript">

var stash    = document.getElementById("stash");
var add      = document.getElementById("add");
var progress = document.getElementById("progress");

stash.className = "stash-h1";
add.className = "";
progress.className = "hidden";

function startUpload(files)
{
  console.log(files);

  // Update UI
  stash.className = "stash-h2"; // add animation
  add.className = "hidden";
  progress.className = "";
  progress.style.width = 0;

  for (var i = 0; i < files.length; i ++)
  {
    var file = files[i];
    console.log("filename : " + file.name);
    console.log("size     : " + file.size);
    console.log("lastDate : " + file.LastModifiedDate);

    uploadFile(file);
  }
}

function uploadFile(file)
{
  var form = new FormData();
  form.append("file", file);

  var xhr = new XMLHttpRequest();
  xhr.onload = function(res) {
    console.log(res.target.response);
    progress.style.width = stash.style.width;
  };
  xhr.upload.addEventListener("progress", function(e) {
    if (e.lengthComputable) {
      console.log(e.loaded / e.total);
      var percentage = e.loaded / e.total;

      var width = stash.clientWidth;
      progress.style.width = Math.round(width * percentage) + "px";
    }
  });

  var url = window.location.href.indexOf("2718") >= 0 ? "" : "http://localhost:2718";

  xhr.open("post", url+"/api/1/upload", true);
  xhr.send(form);
}




function addFiles(files)
{
  startUpload(files);
}

add.addEventListener("dragenter", function dragenter (e)
{
  e.stopPropagation();
  e.preventDefault();

  this.className = "green";
  console.log("dragenter");
}, false);
add.addEventListener("dragover", function dragenter (e)
{
  e.stopPropagation();
  e.preventDefault();

  this.className = "green";
  console.log("dragover");

}, false);
add.addEventListener("drop", function dragenter (e)
{
  e.stopPropagation();
  e.preventDefault();

  var dt = e.dataTransfer;
  var files = dt.files;
  addFiles(files);

}, false);
add.addEventListener("click", function dragenter (e)
{
  document.getElementById("file-input").click();
  console.log("clicked");
}, false);


</script>
</body>
</html>